import java.sql.*;
import java.util.Scanner;

public class MovieDBConsole {
	
	private Connection connection;
	private Scanner s;

	public MovieDBConsole()
	{
		connection = null;
		s = new Scanner(System.in);
	}
	
	public void connect()
	{
		try
		{
			Class.forName("com.mysql.jdbc.Driver").newInstance();
		}
		catch(Exception e)
		{
			System.out.println("Failed to Instantiate a New JDBC Driver. Please Try Again Later.");
			return;
		}
		
		while(connection == null)
		{
			
			try
			{
				System.out.print("Enter Username: ");
				String username = s.nextLine();
				
				System.out.print("Enter Password: ");
				String password = s.nextLine();
				
				connection = DriverManager.getConnection("jdbc:mysql:///moviedb", username, password);
			}
			catch(SQLException e)
			{
				System.out.println("Invalid Username and/or Password. Try Again.");
			}
		}
	}
	
	public void printMoviesWithStars()
	{
		
		try {
			Statement select = connection.createStatement();
			ResultSet result;
			
			System.out.println("Enter Star's Name or ID: ");
			if(s.hasNextInt())
			{
				System.out.println(1);
				int id = s.nextInt();
				result = select.executeQuery(
						"select movies.id, title, year, director, banner_url, trailer_url "
						+ "from movies, stars_in_movies "
						+ "where movies.id = stars_in_movie.movie_id and stars_in_movie.star_id = " + id);
			}
			else
			{
				System.out.println(2);
				String name1 = s.next();
				if(s.hasNext())
				{
					System.out.println(3);
					String name2 = s.next();
					result = select.executeQuery(
							"select movies.id, title, year, director, banner_url, trailer_url "
							+ "from movies, stars_in_movies, stars "
							+ "where movies.id = stars_in_movie.movie_id and stars.id = stars_in_movie.star_id "
							+ "and stars.first_name = '" + name1 + "'and stars.last_name = '" + name2 + "'");
					
				}
				else
				{
					System.out.println(4);
					result = select.executeQuery(
							"select movies.id, title, year, director, banner_url, trailer_url "
							+ "from movies, stars_in_movies, stars "
							+ "where movies.id = stars_in_movie.movie_id and stars.id = stars_in_movie.star_id "
							+ "and (stars.first_name = '" + name1 + "' or stars.last_name = '" + name1 + "')");
				}
			}
			
			printMoviesResultSet(result);
			
		} catch (SQLException e) {
			System.out.println("Database Access Denied.");
		}
	     
	}
	
	private void printMoviesResultSet(ResultSet result) throws SQLException
	{
		while(result.next())
		{
			int id = result.getInt("id");
			int year = result.getInt("year");
			String title = result.getString("title");
			String director = result.getString("director");
			String banner_url = result.getString("banner_url");
			String trailer_url = result.getString("trailer_url");
			
			System.out.format("ID: %-8d, Title: %-50s, \n"
					+ "Year: %-d, Director: %-40s, \n"
					+ "Banner URL: %-100s, \n"
					+ "Trailer URL: %-100s ", id, title, year, director, banner_url, trailer_url);
		}
	}
}
